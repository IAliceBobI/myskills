---
description: 检查测试目录中的错误容忍和掩盖错误问题
---

请检查集成测试目录下所有测试文件，查找以下错误容忍模式：

## 检查项目

### 1. 高严重度问题（High Severity）

**unwrap() 的过度使用**
- 查找模式: `\bunwrap\(\)` (排除 `unwrap_or`)
- 关键操作中的 unwrap（数据库查询、gRPC 调用、余额查询、交易操作）
- 检查是否提供错误上下文

**数据库操作静默失败**
- 查找模式: `\.execute\(.*\)\.await\.ok\(\)`
- 查找模式: `\.fetch_optional\(.*\)\.await\.ok\(\)`
- 数据库清理、更新操作的静默失败

**不当的 unwrap_or_default()**
- 查找模式: `unwrap_or_default\(\)`
- 可能掩盖真实错误的场景（如状态字段、金额字段）

**不当的 unwrap_or()**
- 查找模式: `unwrap_or\([^)]+\)`
- 可能掩盖网络错误的情况（如余额查询、RPC 调用）

### 2. 中严重度问题（Medium Severity）

**expect() 缺少有用的错误信息**
- 查找模式: `expect\("([^"]{0,20})"\)` - 消息少于 20 字符
- 检查是否包含足够的上下文（地址、ID、参数等）

**panic! 使用不当**
- 查找模式: `panic!\("([^"]{0,30})"\)` - 消息少于 30 字符或缺少关键信息
- 检查是否包含请求参数、时间戳、地址等调试信息

**ok() 静默忽略错误**
- 查找模式: `\.ok\(\)` (排除有明确注释的测试场景)
- 环境变量加载、配置加载的错误忽略

### 3. 低严重度问题（Low Severity）

**parse().unwrap()**
- 查找模式: `\.parse\(\)\.unwrap\(\)`
- 字符串解析缺少错误消息

**冗长的 if-else 模式**
- 查找 `if let Some()` 但 else 分支只包含 panic 的情况
- 可以简化的模式匹配

## 输出格式

请按以下格式输出报告：

### 文件名: `xxx.rs`

#### 🔴 高严重度
- **行号**: `<问题代码>`
  - **风险**: [描述风险]
  - **建议**: [改进建议]

#### 🟡 中严重度
- **行号**: `<问题代码>`
  - **风险**: [描述风险]
  - **建议**: [改进建议]

#### 🟢 低严重度
- **行号**: `<问题代码>`
  - **建议**: [改进建议]

---

### 📊 汇总统计

| 严重度 | 问题数量 | 主要影响 |
|--------|----------|----------|
| 🔴 高 | ? | ? |
| 🟡 中 | ? | ? |
| 🟢 低 | ? | ? |

### ✅ 优先修复建议

1. [具体建议]
2. [具体建议]
3. [具体建议]

---

## 检查工具

使用 Grep 工具搜索所有 `.rs` 文件，搜索模式：
- 模式 1: `\bunwrap\(\)\b` (排除 `unwrap_or`)
- 模式 2: `\.ok\(\)`
- 模式 3: `unwrap_or_default\(\)`
- 模式 4: `unwrap_or\(`
- 模式 5: `expect\("[^"]{0,20}"\)`
- 模式 6: `panic!\("[^"]{0,30}"\)`

注意：排除合理的使用场景，如：
- 测试中的 `assert!(result.is_ok())` 后的 `unwrap()`
- 有明确注释说明为什么使用 `.ok()` 的情况
- 测试辅助函数中的错误处理
